(this["webpackJsonpkerfuffle-web"]=this["webpackJsonpkerfuffle-web"]||[]).push([[0],{123:function(e,t,n){},168:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),r=n(16),i=n.n(r),s=(n(91),n.p,n(92),n(93),n(94),n(95),n(96),n(17)),o=n(7),l=n(5),u=n(32),p=(n(97),n(14)),j=n(40),d=n(43),b=n(8),h=n.n(b),f=n(57),O=n(18),x=n(19),m=n.n(x),v=function e(){for(var t={get:function(t,n){return Object.keys(t).includes(n)?t[n]:"$"===n[0]?function(c){return e.apply(void 0,Object(f.a)(t.paths).concat([n.substr(1),c]))}:e.apply(void 0,Object(f.a)(t.paths).concat([n]))}},n=arguments.length,c=new Array(n),a=0;a<n;a++)c[a]=arguments[a];var r={paths:c,toString:function(){return this.paths.join("/")},param:function(e){return this.paths.push(e),this}};return new Proxy(r,t)}("localhost:3000"===window.location.host?"http://localhost:8080":window.location.origin).api.v1;function g(){return(g=Object(O.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get(v.application);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(O.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get(v.$application(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=Object(O.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Posting",v.application,t),e.next=3,m.a.post(v.application,t);case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=Object(O.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.patch(v.$application(t).hold);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=Object(O.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.patch(v.$application(t).reload);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=Object(O.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.patch(v.$application(t).shutdown);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=Object(O.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.patch(v.$application(t).startup);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return(B=Object(O.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.delete(v.$application(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return(P=Object(O.a)(h.a.mark((function e(t,n,c,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.get(v.$application(t).$provision(n).$output(c).toString()+"?from=".concat(a));case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=n(41),C=n(72),R=(n(123),n(29)),T=n(34),I=n(28),M=n(82),A=n(24),L=n(1),D=function(e){var t=e.height;return Object(L.jsx)("div",{style:{height:t||"1em"}})},$=n(83),U=n(45),E=n(27),z=n(84),H=n(36),J=n(53),G=n(54),V=function(e){var t=e.object;return Object(L.jsx)("div",{style:{fontFamily:"'IBM Plex Mono'",fontSize:"0.8em"},children:Object(L.jsx)(I.a,{text:JSON.stringify(t,null,2),language:"json",showLineNumbers:!1,theme:I.c})})},q=function(e){var t=e.header,n=e.data;return Object(L.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(L.jsx)("h4",{children:t}),Object(L.jsx)("p",{children:Object(L.jsx)("code",{children:n})})]})};function K(e){var t=e.app;return Object(L.jsx)("div",{children:Object(L.jsx)(V,{object:t.cfs})})}function W(e){var t=e.app;return Object(L.jsx)("div",{children:Object(L.jsx)(V,{object:t.proxies})})}function Q(e){var t=e.app;return Object(L.jsx)("div",{children:Object.values(t.provisions).map((function(e){return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(D,{height:"1em"}),Object(L.jsx)(A.Panel,{header:e.id.toString().toUpperCase(),children:Object(L.jsx)(V,{object:e})})]})}))})}function X(e){var t=e.app_id,n=e.provision,a=e.log_type,r=e.close,i=Object(c.useState)(""),s=Object(o.a)(i,2),l=s[0],u=s[1],p=Object(c.useState)(0),d=Object(o.a)(p,2),b=d[0],h=d[1],f=Object(c.useRef)(null);return console.log(t,n,a,b),Object(c.useEffect)((function(){return console.log(t,n,a,b),f.current=setInterval(function e(){return function(e,t,n,c){return P.apply(this,arguments)}(t,n,a,b).then((function(e){h(e.next),u(l+e.content)})),e}(),1e3),function(){u(""),h(0),clearInterval(f.current)}}),[t,n,a]),Object(L.jsxs)(j.Dialog,{header:"'".concat(a,"' Output View: ").concat(n),visible:!0,onHide:r,style:{whiteSpace:"pre-line",fontFamily:"'IBM Plex mono'",fontSize:"0.8em",width:"50vw"},children:[!l&&Object(L.jsx)(T.ProgressBar,{mode:"indeterminate"}),Object(L.jsx)(I.a,{text:l,showLineNumbers:!1,theme:I.b})]})}function Y(e){var t=e.app,n=e.reload,a=Object(c.useRef)(null),r=Object(c.useState)(null),i=Object(o.a)(r,2),l=i[0],u=i[1],j=Object(c.useState)(!1),d=Object(o.a)(j,2),b=d[0],h=d[1],f=function(){(function(e){return N.apply(this,arguments)})(t.application.id).then((function(e){a.current.show({severity:"info",summary:"Success",detail:"Toggled maintenance mode",life:3e3}),n&&n()})).catch((function(e){a.current.show({severity:"error",summary:"Failed",detail:"Failed to toggle maintenance mode",life:3e3})}))},O=t.application.status_log&&t.application.status_log[0],x=Object(c.useRef)(null),m=Object(c.useRef)(null),v=function(){u(null)},g=Object.entries(t.processes).map((function(e){var t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(s.a)(Object(s.a)({},c),{},{id:n})})),y=function(e){return Object.values(t.provisions).map((function(n){return{label:n.id,command:function(){u(Object(L.jsx)(X,{close:v,app_id:t.application.id,provision:n.id,log_type:e}))}}}))};return Object(L.jsxs)("div",{className:"p-grid",children:[Object(L.jsxs)("div",{className:"p-col-8",children:[Object(L.jsx)(M.Toast,{ref:a}),Object(L.jsx)(A.Panel,{header:"Information",children:Object(L.jsxs)("div",{className:"p-grid",children:[Object(L.jsx)("div",{className:"p-col-6",children:Object(L.jsxs)("dl",{children:[Object(L.jsx)("dt",{children:"ID"}),Object(L.jsx)("dd",{children:t.application.id}),Object(L.jsx)("dt",{children:"Repository"}),Object(L.jsx)("dd",{children:Object(L.jsx)("a",{target:"_blank",href:t.application.install_configuration.repository,children:t.application.install_configuration.repository})}),Object(L.jsx)("dt",{children:"Branch"}),Object(L.jsx)("dd",{children:t.application.install_configuration.branch})]})}),Object(L.jsx)("div",{className:"p-col-6",children:Object(L.jsxs)("dl",{children:[Object(L.jsx)("dt",{children:"Bootstrap"}),Object(L.jsx)("dd",{children:t.application.install_configuration.bootstrap}),Object(L.jsx)("dt",{children:"Meta.name"}),Object(L.jsx)("dd",{children:t.application.meta.name}),Object(L.jsx)("dt",{children:"Physical Location"}),Object(L.jsx)("dd",{children:t.application.root_path})]})})]})}),Object(L.jsx)(D,{}),Object(L.jsx)(A.Panel,{header:"Process Status",children:Object(L.jsxs)($.DataTable,{value:g,className:"p-datatable-sm",children:[Object(L.jsx)(U.Column,{field:"id",style:{width:"15%",fontWeight:"bold"},header:"Provision"}),Object(L.jsx)(U.Column,{header:"State",style:{width:"10%"},body:function(e){return e.alive?Object(L.jsx)(E.Tag,{className:"p-mr-2",value:"Alive",severity:"success"}):Object(L.jsx)(E.Tag,{className:"p-mr-2",value:"Dead",severity:"danger"})}}),Object(L.jsx)(U.Column,{header:"Status",body:function(e){return Object(L.jsx)("code",{children:e.status})}})]})}),Object(L.jsx)(D,{}),Object(L.jsx)(A.Panel,{header:"Events",children:Object(L.jsx)(z.Timeline,{value:t.application.status_log,opposite:function(e){return e.reason},content:function(e){return Object(L.jsx)("small",{className:"p-text-secondary",children:new Date(e.at).toGMTString()})}})})]}),Object(L.jsxs)("div",{className:"p-col-4",children:[O&&Object(L.jsxs)("div",{className:"p-fluid",children:[Object(L.jsx)(H.Message,{severity:{booting:"warn",running:"info",failed:"error",crashed:"error",shutdown:"warn",unknown:""}[O.flag],text:O.reason}),Object(L.jsx)(D,{})]}),t.application.maintenance_mode&&Object(L.jsxs)("div",{className:"p-fluid",children:[Object(L.jsx)(H.Message,{severity:"warn",text:"This application is in maintenance mode"}),Object(L.jsx)(D,{})]}),Object(L.jsxs)(A.Panel,{header:"Actions",children:[b&&Object(L.jsx)(T.ProgressBar,{mode:"indeterminate"}),Object(L.jsx)(p.Button,{label:"Reload",className:"p-button-outlined",onClick:function(){h(!0),function(e){return k.apply(this,arguments)}(t.application.id).then((function(e){a.current.show({severity:"info",summary:"Success",detail:"Reloading Application",life:3e3}),n&&n()})).catch((function(e){a.current.show({severity:"error",summary:"Failed",detail:"Action Failed: ".concat(e.response.data.error),life:3e3})})).finally((function(){return h(!1)}))}}),O&&"running"===O.flag&&Object(L.jsx)(p.Button,{label:"Shutdown",className:"p-button-outlined p-button-help",onClick:function(){(function(e){return S.apply(this,arguments)})(t.application.id).then((function(e){a.current.show({severity:"info",summary:"Success",detail:"Shutting down Application",life:3e3}),n&&n()})).catch((function(e){a.current.show({severity:"error",summary:"Failed",detail:"Action Failed: ".concat(e.response.data.error),life:3e3})}))}}),O&&"shutdown"===O.flag&&Object(L.jsx)(p.Button,{label:"Start",className:"p-button-outlined p-button-help",onClick:function(){(function(e){return F.apply(this,arguments)})(t.application.id).then((function(e){a.current.show({severity:"info",summary:"Success",detail:"Starting Application",life:3e3}),n&&n()})).catch((function(e){a.current.show({severity:"error",summary:"Failed",detail:"Action Failed: ".concat(e.response.data.error),life:3e3})}))}}),Object(L.jsx)(p.Button,{label:"Delete",className:"p-button-outlined p-button-danger",onClick:function(){(function(e){return B.apply(this,arguments)})(t.application.id).then((function(e){a.current.show({severity:"info",summary:"Success",detail:"Deleting Application",life:3e3}),n&&n()})).catch((function(e){a.current.show({severity:"error",summary:"Failed",detail:"Action Failed: ".concat(e.response.data.error),life:3e3})}))}}),Object(L.jsx)(J.Divider,{align:"left",children:Object(L.jsx)("b",{children:"Maintenance Mode"})}),t.application.maintenance_mode?Object(L.jsx)(p.Button,{label:"Go Live",onClick:f,className:"p-button-outlined p-button-success"}):Object(L.jsx)(p.Button,{label:"Hold Application",onClick:f,className:"p-button-outlined p-button-warning"}),Object(L.jsx)(J.Divider,{align:"left",children:Object(L.jsx)("b",{children:"Logs"})}),l&&l,Object(L.jsx)(G.Menu,{model:y("log"),popup:!0,ref:x,id:"popup_menu"}),Object(L.jsx)(p.Button,{label:"Stdout",icon:"pi pi-bars",onClick:function(e){return x.current.toggle(e)},"aria-controls":"popup_menu","aria-haspopup":!0}),Object(L.jsx)(G.Menu,{model:y("err"),popup:!0,ref:m,id:"popup_menu"}),Object(L.jsx)(p.Button,{label:"Stderr",icon:"pi pi-bars",onClick:function(e){return m.current.toggle(e)},"aria-controls":"popup_menu","aria-haspopup":!0})]}),Object(L.jsx)(D,{}),Object(L.jsx)(A.Panel,{header:"Last Commit",children:Object(L.jsx)("div",{style:{whiteSpace:"pre-line",fontFamily:"'IBM Plex mono'",fontSize:"0.8em"},children:t.last_commit})}),Object(L.jsx)(D,{})]})]})}var Z=function(){var e=Object(l.f)().appId,t=Object(c.useState)(),n=Object(o.a)(t,2),a=n[0],r=n[1],i=Object(c.useState)(!1),s=Object(o.a)(i,2),u=s[0],p=s[1],j=Object(c.useState)(),d=Object(o.a)(j,2),b=d[0],h=d[1],f=Object(c.useRef)(null),O=Object(c.useState)([{label:"Loading..."}]),x=Object(o.a)(O,2),m=x[0],v=x[1];Object(c.useEffect)((function(){p(!0);var t=setInterval(function t(){return function(e){return y.apply(this,arguments)}(e).then((function(e){r(e),v([{label:e.application.id}])})).catch((function(e){f.current&&f.current.show({severity:"error",sticky:!0,content:Object(L.jsx)(q,{header:"Failed to load",data:e.response.data.error})})})).finally((function(){return p(!1)})),t}(),5e3);return function(){return clearInterval(t)}}),[e,b]);return Object(L.jsxs)("div",{className:"app-view-panel",children:[Object(L.jsx)(C.BreadCrumb,{model:m,home:{icon:"pi pi-cog",url:"/console"}}),Object(L.jsx)("div",{className:"p-field p-fluid",children:Object(L.jsx)(_.Messages,{ref:f})}),u&&Object(L.jsx)("div",{className:"p-field pi-fluid fl-center",children:Object(L.jsx)(T.ProgressBar,{mode:"indeterminate"})}),a&&Object(L.jsxs)(R.TabView,{children:[Object(L.jsx)(R.TabPanel,{header:"Overview",children:Object(L.jsx)(Y,{app:a,reload:function(){h(Math.random())}})}),Object(L.jsx)(R.TabPanel,{header:"Provisions",children:Object(L.jsx)(Q,{app:a})}),Object(L.jsx)(R.TabPanel,{header:"Reverse Proxies",children:Object(L.jsx)(W,{app:a})}),Object(L.jsx)(R.TabPanel,{header:"Cloudflare",children:Object(L.jsx)(K,{app:a})})]})]})},ee=(n(166),function(){return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("div",{className:"header",children:Object(L.jsx)("span",{className:"logotype",children:"\\kerfuffle\\"})}),Object(L.jsx)("div",{className:"p-d-flex p-jc-center",children:Object(L.jsxs)(l.c,{children:[Object(L.jsx)(l.a,{path:"/application/:appId",children:Object(L.jsx)(Z,{})}),Object(L.jsx)(l.a,{path:"/",children:Object(L.jsx)(te,{})})]})})]})}),te=function(){var e=Object(c.useState)(!1),t=Object(o.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)([]),i=Object(o.a)(r,2),l=i[0],u=i[1],b=Object(c.useState)(),h=Object(o.a)(b,2),f=(h[0],h[1]),O=Object(c.useState)(!1),x=Object(o.a)(O,2),m=x[0],v=x[1],y=Object(c.useState)({repository:"",branch:"master",boostrap:".kerfuffle"}),N=Object(o.a)(y,2),k=N[0],S=N[1],F=Object(c.useState)(),B=Object(o.a)(F,2),P=B[0],C=B[1],R=Object(c.useState)(!1),T=Object(o.a)(R,2),I=T[0],M=T[1],A=Object(c.useRef)(null);Object(c.useEffect)((function(){(function(){return g.apply(this,arguments)})().then((function(e){e?(u(e),v(!1)):v(!0)})).catch((function(e){return f(e)}))}),[P]);var D,$=function(){M(!0),function(e){return w.apply(this,arguments)}(k).then((function(e){a(!1),C(Math.random())})).catch((function(e){console.debug(e.response),A.current.show({severity:"error",sticky:!0,content:Object(L.jsxs)("div",{className:"error-message",children:[Object(L.jsx)("h4",{children:"Failed to deploy"}),Object(L.jsx)("code",{children:e.response.data.error})]})})})).finally((function(){M(!1)}))};return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)("div",{className:"application-view",children:[Object(L.jsx)("div",{className:"actions",children:Object(L.jsx)(p.Button,{label:"Add Repository",className:"p-button-outlined p-button-help",onClick:function(){return a(!0)}})}),m&&Object(L.jsx)("div",{className:"responsive p-field p-fluid",children:Object(L.jsx)(H.Message,{severity:"info",text:"There's no applications. Click on Add Repository to add one."})}),l.map((function(e){return Object(L.jsx)(ne,{application:e})}))]}),Object(L.jsxs)(j.Dialog,{header:"Add New Repository",visible:n,className:"responsive",footer:(D=function(){return a(!1)},Object(L.jsxs)("div",{children:[Object(L.jsx)(p.Button,{label:"Cancel",icon:"pi pi-times",onClick:D,className:"p-button-text"}),Object(L.jsx)(p.Button,{label:I?"Installing...":"Add Repository",icon:"pi pi-check",onClick:$,autoFocus:!0,disabled:I})]})),onHide:function(){return a(!1)},children:[Object(L.jsxs)("div",{className:"p-field p-fluid",children:[Object(L.jsxs)("label",{htmlFor:"repoURL",className:"p-d-block",children:["Repository URL ",Object(L.jsx)("code",{children:"*required"})]}),Object(L.jsx)(d.InputText,{value:k.repository,onInput:function(e){return S(Object(s.a)(Object(s.a)({},k),{},{repository:e.target.value}))},id:"repoURL","aria-describedby":"username1-help",className:"p-d-block"}),Object(L.jsx)("small",{id:"repoURL-help",className:"p-d-block",children:"URL to clone"})]}),Object(L.jsxs)("div",{className:"p-field p-fluid",children:[Object(L.jsx)("label",{htmlFor:"branch",className:"p-d-block",children:"Branch"}),Object(L.jsx)(d.InputText,{value:k.branch,onInput:function(e){return S(Object(s.a)(Object(s.a)({},k),{},{branch:e.target.value}))},id:"branch","aria-describedby":"username1-help",className:"p-d-block"}),Object(L.jsxs)("small",{id:"branch-help",className:"p-d-block",children:["Branch to checkout after cloning, leave empty to use ",Object(L.jsx)("code",{children:"master"})]})]}),Object(L.jsxs)("div",{className:"p-field p-fluid",children:[Object(L.jsx)("label",{htmlFor:"bootstrap",className:"p-d-block",children:"Kerfuffle Bootstrap File"}),Object(L.jsx)(d.InputText,{value:k.boostrap,onInput:function(e){return S(Object(s.a)(Object(s.a)({},k),{},{bootstrap:e.target.value}))},id:"bootstrap","aria-describedby":"username1-help",className:"p-d-block"}),Object(L.jsxs)("small",{id:"bootstrap-help",className:"p-d-block",children:["Bootstrap file to use, leave empty to use ",Object(L.jsx)("code",{children:".kerfuffle"})]})]}),Object(L.jsx)("div",{className:"p-field p-fluid",children:Object(L.jsx)(_.Messages,{ref:A})})]})]})},ne=function(e){var t=e.application,n=t.status_log&&t.status_log[0],c="running"!==n.flag;return Object(L.jsx)(u.b,{to:"/application/".concat(t.id),children:Object(L.jsxs)("div",{className:"item",children:[Object(L.jsxs)("div",{className:"left-info",children:[Object(L.jsx)("i",{className:"pi pi-clone icon"}),"running"===n.flag&&Object(L.jsx)(E.Tag,{className:"p-mr-2",value:"Running"}),"running"!==n.flag&&Object(L.jsx)(E.Tag,{className:"p-mr-2",value:n.flag}),Object(L.jsx)("span",{children:t.meta.name||t.id}),c&&Object(L.jsx)("i",{className:"pi pi-exclamation-circle icon-error"})]}),Object(L.jsxs)("div",{className:"right-info",children:[Object(L.jsx)("i",{className:"pi pi-link icon-1"}),Object(L.jsxs)("span",{children:[t.install_configuration.repository," \u2022\xa0"]}),Object(L.jsxs)("span",{children:[t.install_configuration.branch,"\xa0"]})]})]})})};var ce=function(){return Object(L.jsx)(u.a,{children:Object(L.jsx)("div",{className:"App",children:Object(L.jsx)(ee,{})})})},ae=function(e){e&&e instanceof Function&&n.e(155).then(n.bind(null,354)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))};i.a.render(Object(L.jsx)(a.a.StrictMode,{children:Object(L.jsx)(ce,{})}),document.getElementById("root")),ae()},91:function(e,t,n){},92:function(e,t,n){},97:function(e,t,n){}},[[168,152,153]]]);
//# sourceMappingURL=main.85c002a2.chunk.js.map